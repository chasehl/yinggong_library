<!-- pages/me/me.wxml -->
<view class="me-page">
  <!-- 1. ç”¨æˆ·ä¿¡æ¯å¡ç‰‡ -->
  <view class="user-card">
    <view class="user-bg"></view>
    <view class="user-info">
      <view class="avatar-section" bindtap="handleAvatarTap">
        <image class="avatar" src="{{userInfo.avatarUrl || '/images/default-avatar.png'}}"></image>
        <view class="avatar-edit">ç¼–è¾‘</view>
      </view>
      <view class="user-main">
        <view class="user-name">{{userInfo.nickName || 'ç‚¹å‡»ç™»å½•'}}</view>
        <view class="user-id">ID: {{userInfo.studentId || 'æœªç»‘å®šå­¦å·'}}</view>
        <view class="user-meta">
          <text class="meta-item">ä¼šå‘˜ç­‰çº§: {{userInfo.level || 'æ™®é€šä¼šå‘˜'}}</text>
          <text class="meta-item">ç§¯åˆ†: {{userInfo.points || 0}}</text>
        </view>
      </view>
      <view class="user-actions">
        <button wx:if="{{!userInfo.nickName}}" class="login-btn" bindtap="handleLogin" size="mini" type="primary">ç™»å½•</button>
        <button wx:else class="logout-btn" bindtap="handleLogout" size="mini" plain>é€€å‡º</button>
      </view>
    </view>
  </view>

  <!-- 2. æ•°æ®ç»Ÿè®¡å¡ç‰‡ -->
  <view class="stats-card">
    <view class="stats-grid">
      <view class="stats-item" bindtap="goToBorrowed">
        <text class="stats-number">{{borrowStats.borrowedCount || 0}}</text>
        <text class="stats-label">åœ¨å€Ÿå›¾ä¹¦</text>
      </view>
      <view class="stats-item" bindtap="goToHistory">
        <text class="stats-number">{{borrowStats.historyCount || 0}}</text>
        <text class="stats-label">å†å²å€Ÿé˜…</text>
      </view>
      <view class="stats-item" bindtap="goToReserved">
        <text class="stats-number">{{borrowStats.reservedCount || 0}}</text>
        <text class="stats-label">å·²é¢„çº¦</text>
      </view>
      <view class="stats-item" bindtap="goToOverdue">
        <text class="stats-number overdue {{borrowStats.overdueCount > 0 ? 'has-overdue' : ''}}">
          {{borrowStats.overdueCount || 0}}
        </text>
        <text class="stats-label">é€¾æœŸ</text>
      </view>
    </view>
  </view>

  <!-- 3. åŠŸèƒ½èœå•åˆ—è¡¨ -->
  <view class="menu-section">
    <view class="menu-title">æˆ‘çš„æœåŠ¡</view>
    
    <view class="menu-list">
      <!-- ç¬¬ä¸€è¡Œï¼šå€Ÿé˜…ç›¸å…³ -->
      <view class="menu-item" bindtap="goToBorrowed">
        <view class="menu-icon icon-borrowed"></view>
        <text class="menu-text">æˆ‘çš„å€Ÿé˜…</text>
        <view class="menu-badge" wx:if="{{borrowStats.borrowedCount > 0}}">{{borrowStats.borrowedCount}}</view>
        <view class="menu-arrow">></view>
      </view>
      
      <view class="menu-item" bindtap="goToReserved">
        <view class="menu-icon icon-reserved"></view>
        <text class="menu-text">æˆ‘çš„é¢„çº¦</text>
        <view class="menu-badge" wx:if="{{borrowStats.reservedCount > 0}}">{{borrowStats.reservedCount}}</view>
        <view class="menu-arrow">></view>
      </view>
      
      <view class="menu-item" bindtap="goToHistory">
        <view class="menu-icon icon-history"></view>
        <text class="menu-text">å€Ÿé˜…å†å²</text>
        <view class="menu-arrow">></view>
      </view>
      
      <view class="menu-item" bindtap="goToFavorites">
        <view class="menu-icon icon-favorites"></view>
        <text class="menu-text">æˆ‘çš„æ”¶è—</text>
        <view class="menu-badge" wx:if="{{borrowStats.favoriteCount > 0}}">{{borrowStats.favoriteCount}}</view>
        <view class="menu-arrow">></view>
      </view>
    </view>
    
    <!-- åˆ†å‰²çº¿ -->
    <view class="menu-divider"></view>
    
    <view class="menu-list">
      <!-- ç¬¬äºŒè¡Œï¼šè´¦æˆ·è®¾ç½® -->
      <view class="menu-item" bindtap="goToSettings">
        <view class="menu-icon icon-settings"></view>
        <text class="menu-text">è´¦æˆ·è®¾ç½®</text>
        <view class="menu-arrow">></view>
      </view>
      
      <view class="menu-item" bindtap="goToMessage">
        <view class="menu-icon icon-message"></view>
        <text class="menu-text">æ¶ˆæ¯ä¸­å¿ƒ</text>
        <view class="menu-badge" wx:if="{{unreadMessageCount > 0}}">{{unreadMessageCount}}</view>
        <view class="menu-arrow">></view>
      </view>
      
      <view class="menu-item" bindtap="goToFeedback">
        <view class="menu-icon icon-feedback"></view>
        <text class="menu-text">æ„è§åé¦ˆ</text>
        <view class="menu-arrow">></view>
      </view>
      
      <view class="menu-item" bindtap="goToAbout">
        <view class="menu-icon icon-about"></view>
        <text class="menu-text">å…³äºæˆ‘ä»¬</text>
        <view class="menu-arrow">></view>
      </view>
    </view>
  </view>

  <!-- 4. æ“ä½œæŒ‰é’® -->
  <view class="action-section">
    <button class="action-btn primary" bindtap="goToScanBorrow">
      <view class="action-icon">ğŸ“š</view>
      <text class="action-text">æ‰«ç å€Ÿä¹¦</text>
    </button>
    <button class="action-btn secondary" bindtap="goToRenew">
      <view class="action-icon">ğŸ”„</view>
      <text class="action-text">ä¸€é”®ç»­å€Ÿ</text>
    </button>
  </view>

  <!-- 5. åº•éƒ¨ç‰ˆæœ¬ä¿¡æ¯ -->
  <view class="footer">
    <text class="version">ç‰ˆæœ¬å·: v1.0.0</text>
    <text class="copyright">Â© 2023 æ™ºæ…§å›¾ä¹¦é¦†</text>
  </view>
</view>