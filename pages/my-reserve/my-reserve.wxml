<!--pages/my-reserve/my-reserve.wxml-->
<view class="container">

<view class="tabs-header">
  <view class="tab-item {{currentTab === 0 ? 'active' : ''}}" bindtap="switchTab" data-index="{{0}}">
    当前预约
    <view class="tab-line" wx:if="{{currentTab === 0}}"></view>
  </view>
  <view class="tab-item {{currentTab === 1 ? 'active' : ''}}" bindtap="switchTab" data-index="{{1}}">
    历史记录
    <view class="tab-line" wx:if="{{currentTab === 1}}"></view>
  </view>
</view>

<scroll-view class="list-content" scroll-y="true">
  
  <block wx:for="{{displayList}}" wx:key="id">
    <view class="reserve-card">
      
      <image class="book-cover" src="{{item.cover}}" mode="aspectFill" bindtap="goToBookDetail" data-id="{{item.bookId}}"></image>
      
      <view class="card-info">
        <view class="info-top">
          <text class="title">{{item.title}}</text>
          <text class="status-tag status-green" wx:if="{{item.status === 'ready'}}">待取书</text>
          <text class="status-tag status-orange" wx:elif="{{item.status === 'waiting'}}">排队中</text>
          <text class="status-tag status-grey" wx:else>{{item.statusText}}</text>
        </view>

        <text class="author">{{item.author}}</text>
        
        <view class="meta-box">
          <block wx:if="{{item.status === 'ready'}}">
            <view class="meta-row">
              <text class="label">取书地点：</text>
              <text class="value highlight">{{item.location}}</text>
            </view>
            <view class="meta-row">
              <text class="label">保留截止：</text>
              <text class="value">{{item.expireDate}}</text>
            </view>
          </block>

          <block wx:elif="{{item.status === 'waiting'}}">
            <view class="meta-row">
              <text class="label">当前位次：</text>
              <text class="value">第 {{item.rank}} 位 / 共 {{item.totalQueue}} 人</text>
            </view>
            <view class="meta-row">
              <text class="label">申请时间：</text>
              <text class="value">{{item.applyDate}}</text>
            </view>
          </block>

          <block wx:else>
            <view class="meta-row">
              <text class="label">处理时间：</text>
              <text class="value">{{item.finishDate}}</text>
            </view>
          </block>
        </view>
      </view>

      <view class="action-area" wx:if="{{currentTab === 0}}">
        <button class="cancel-btn" size="mini" bindtap="handleCancel" data-id="{{item.id}}" data-title="{{item.title}}">取消预约</button>
      </view>

    </view>
  </block>

  <view class="empty-state" wx:if="{{displayList.length === 0}}">
    <image src="/images/empty-box.png" class="empty-img" mode="widthFix" />
    <text>{{currentTab === 0 ? '当前没有进行中的预约' : '暂无历史预约记录'}}</text>
  </view>

</scroll-view>
</view>